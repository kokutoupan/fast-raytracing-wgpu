# Fast Raytracing WGPU

Rust と WGPU を使用した、ハードウェアアクセラレーション対応のリアルタイムレイトレーサーです。
Cornell Box などのシーンをリアルタイムにレンダリングし、アキュムレーション（蓄積）による画質向上をサポートしています。

## 特徴

- **リアルタイムレイトレーシング**: WGPU の Experimental Ray Query 機能を使用し、GPU のレイトレーシングハードウェアを活用します。
- **アキュムレーションレンダリング**: 視点を固定することでサンプルを蓄積し、ノイズの少ない高品質な画像を生成します。
- **非同期スクリーンショット保存**: レンダリングループをブロックすることなく、バックグラウンドでスクリーンショットを保存します。
- **AI デノイズ (オプション)**: Intel Open Image Denoise (OIDN) を使用した高品質なノイズ除去機能をサポートしています。

## 必要条件

- **Rust**: 最新の Stable ツールチェーン
- **GPU**: Vulkan をサポートし、ハードウェアレイトレーシングに対応した GPU

## ビルドと実行

### 通常実行

標準モードでは、スクリーンショットは高速に保存されます（デノイズなし）。

```bash
cargo run --release
```

### AI デノイズ有効化

高品質なスクリーンショットを保存したい場合は、`ai-denoise` 機能（Intel OIDN）を有効にしてビルドします。
※ 初回ビルド時に OIDN のライブラリをダウンロード・コンパイルするため時間がかかります。

```bash
# 初回のみ
./init.sh

# 通常
cargo run --release --features ai-denoise
```

## 操作方法

アプリケーション起動後の操作方法は以下の通りです。

| キー / 操作    | 説明                                                            |
| :------------- | :-------------------------------------------------------------- |
| **W, A, S, D** | カメラの移動 (前後左右)                                         |
| **矢印キー**   | カメラの向き変更 (上下左右)                                     |
| **Space**      | カメラ上昇                                                      |
| **Shift**      | カメラ下降                                                      |
| **J**          | レンダリングの一時停止/再開 (アキュムレーションの停止)          |
| **K**          | スクリーンショットの保存 (`output/` ディレクトリに保存されます) |

## スクリーンショット機能

**K** キーを押すとスクリーンショットを撮影します。画像は `output/` ディレクトリにタイムスタンプ付きの PNG ファイルとして保存されます。

- **Fast Mode (デフォルト)**:
  - 現在表示されているバッファをそのまま高速に保存します。
  - 処理時間: 数十ミリ秒程度
- **AI Denoise Mode (`--features ai-denoise`)**:
  - Intel OIDN を使用してノイズを除去してから保存します。
  - アキュムレーション数が少ない状態でも綺麗な画像が得られます。
  - 処理時間: 1 秒〜数秒程度（環境による）

## ライセンス

MIT License

このプロジェクトは学習および実験目的で作成されています。
